# B2: Bridging Code and Interactive Visualization in Computational Notebooks

> **Source**: [`B2: Bridging Code and Interactive Visualization in Computational Notebooks`](http://vis.mit.edu/pubs/b2) | Yifan Wu, Joseph M. Hellerstein, Arvind Satyanarayan | 2020 | [Repo](https://github.com/ucbrise/b2) | [Study Repo](https://github.com/yifanwu/midas-exp-pub)

Sunday, September 6, 2020

- [Presentation and demo](https://github.com/joaopalmeiro/b2-presentation).
- This paper is divided as follows:
  - Abstract.
  - Introduction.
  - B2 demo (_case study_ style).
  - Related work.
  - _Theoretical_ considerations.
  - System design and implementation.
  - Evaluation (first-use study with 7 participants).
  - Conclusion.
- _Computational notebook_ is a broader term for Jupyter or Observable, for example, notebooks.
- B2 is implemented as an extension for Jupyter Notebook ([nbextension](https://testnb.readthedocs.io/en/latest/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html)).
  - The project setup is based on [ipyvega](https://github.com/vega/ipyvega).
  - It consists of two major components:
    - A Python back-end component.
    - A JavaScript front-end component.
  - Main tech stack (excluding Jupyter-related stuff):
    - Berkeley's _[datascience](https://github.com/data-8/datascience)_ Python package (for data frames).
    - Python and IPython.
    - React.
    - TypeScript.
    - Vega-Lite (it leverages Vega-Lite's _grammar of interaction_) and Vega-Embed.
    - webpack.
  - It does not support pandas, at least for now (more information in [this issue](https://github.com/yifanwu/b2/issues/10)).
  - [This repo](https://github.com/jupyter-widgets/widget-cookiecutter) contains a cookiecutter template that shows what is (minimally) necessary to create a Jupyter widget.
- "Currently, although these media \[code cells and visualizations\] may be interleaved, they remain **siloed**: interactive visualizations must be manually specified as they are divorced from the analysis provenance expressed via data frames, while code cells have no access to users' interactions with visualizations (...)."
- "(...) **data queries** as a shared representation between the code and interactive visualizations."
  - "The fundamental task of data analysis involves **iterative data transformation**, and both code \[via data frame manipulations\] and interactive visualizations \[via interactive selections\] can capture this task as a _data query_."
- The charts are displayed on a dashboard located to the right of the notebook. The dashboard panel facilitates (interactive) multi-view displays (regardless of the source cell).
- "When an interaction occurs, B2 reifies \[materializes/persists\] it as a data query and generates a history log in a new code cell."
  - Interactive selections are represented by their underlying predicate definitions.
  - This log is reusable when (un)commenting/copying and pasting entries _manually_.
  - All entries except the most recent one are folded (hidden) in the cell, and to reuse them, it is necessary to first unfold them (toggle hide/show). Entries continue to be added to the same cell until the user switches to the notebook panel.
  - The user "(...) can toggle the hiding of all generated cells with the `Toggle` \[button\]."
  - "(...) the interaction history that B2 produces is expressed as a series of human-understandable API calls \[a principle of literate programming\], rather than low-level event logs."
  - "(...) to preserve the linear flow of literate computing, B2 records these interaction histories in new code cells placed **directly after the most recently executed cell**."
- Cells marked as _reactive_ (via the `%%reactive` magic command) are automatically recomputed when new interactions occur. This feature is particularly interesting to allow charts created with other libraries, for example, to also be integrated into the workflow (there is an example with [Folium](https://python-visualization.github.io/folium/)).
- "(...) computational notebooks remain useful far beyond the initial act of authoring: e.g., for auditing, reproducing, or sharing data insights."
- "As there may be several cells between successive visualizations, it is unlikely to have more than one visualization visible on screen; thus, interaction techniques become confined to operating over a single visualization at a time (...)."
- The main persona for B2 seems to be the _analyst_.
- The related work section is divided into two blocks regarding integrating code and interaction:
  - Interactions **parameterizing** code ([ipywidgets](https://github.com/jupyter-widgets/ipywidgets), for example).
  - Interactions **generating** code.
- "B2 synthesizes appropriate visualizations by tracing the data lineage expressed in code (...)."
- Important question that B2 tries to answer:
  - How to combine "(...) the highly iterative nature and two-dimensional layout of interactive visualizations with the persistence and linear layout of computational notebooks (...)"?
- B2 vs. [mage](https://dig.cmu.edu/publications/2020-mage.html):
  - "B2 targets integrating code with interactive visualizations specifically, whereas %mage looks to graphical interfaces more broadly."
  - "(...) %mage uses string templates and pattern matching to translate interactions to code (...). In contrast, B2 records interaction histories as _predicates_, a representation that is tailored to interactive visualization but is also more robust to bidirectional changes."
- The authors identify three gaps:
  - Semantic gap: this gap "(...) prevents each side \[code cells and visualizations\] from understanding the work that is happening in the other;"
  - Temporal gap: this gap "(...) allows **only** code to persist, and **only** interactions on visualizations to be transient;"
  - Layout gap: this gap occurs "(...) between the notebook's linear structure and rich coordinated multi-view visualizations."
- **Semantic gap**:
  - "(...) visualizations do not understand the work expressed in code: specifically it is blind to the lineage of transformations and derivations on a data frame. (...) an analyst must manually construct appropriate interactive visualizations from scratch even if the code that specifies the data frame **captures semantics that can automate visualization design**." Two examples:
    - "(...) when data results from a _group_ operator, it is typical to favor a _bar_ marks to produce a histogram."
    - "(...) visualizations of two derived data frames that share a common ancestor can often be usefully linked or cross-filtered."
  - "(...) every Vega-Lite selection includes a definition for a _predicate_ \[data query\] (...)."
    - Intensional predicate: it "(...) specifies a set of data points based on logical conditions that must be satisfied (...)."
    - Extensional predicate: it "(...) enumerates a set of selected data points."
- **Temporal gap**:
  - "(...) we need to enable users to make their exploratory iterations in visualization **persist** when appropriate, and make their code iteration **more transient** when appropriate."
  - To address this gap, B2 provides features to capture "(...) a snapshot of visualization (...)", to materialize "(...) interactions as a history log or a (...) data frame (...)", and to create "(...) reactive cells that automatically re-execute when new interaction occurs."
- **Layout gap**:
  - Challenges:
    - "(...) a dashboard layout breaks the formerly tight coupling between a visualization and the code cell containing its specification (...)."
    - "(...) as interactions on visualizations now occur in the dashboard rather than as part of the linear notebook layout, should code cells containing interaction histories be automatically created or manually requested? (...) where should they be placed in the linear structure of the notebook (...)?"
- "B2 provides a simple Python API to generate interactive visualizations from data frame code." It adds a method, `.vis`, that "(...) does not require any parameters to work — B2 can infer the specification for a data frame visualization using established heuristics (...)." On the other hand, the "(...) `.vis` can be controlled directly via a set of optional parameters based on Vega-Lite configuration specifications (...)":
  - "The `mark` parameter chooses among bar charts, scatter plots, and line charts;"
  - "`encoding` configures which column is the x-axis, y-axis, how they should be interpreted (ordinal, quantitative, temporal), and sorted;"
  - "`selection_type` and `selection_dimensions` configure how the selection should happen and whether the selection is the x-axis, y-axis, or both."
- The user does not need "(...) to specify any interaction logic — we _infer_ that logic through the data lineage of the queries." If two data frames derive from the same data frame, "(...) infers that they should be linked (...)", for example.
- Selections (interactions) can be accessed in three different ways:
  - Predicates: `b2.current_selection` or `b2.all_selections`.
  - Data from the current selection: `df.get_filtered_data()`.
  - Code from the current selection: `df.get_code()` (or via the `Copy Code to Clipboard` button).
- The `snapshot` button allows to _save_ "(...) an SVG representation of the state of all visible visualizations in a notebook cell and the code to derive the data for the respective visualizations in comments."
- B2 is interesting for situations where we want to repeat the same analysis, including the interactive part, for another dataset with a similar schema to the initial one.
- None of the first-use study participants "(...) used B2's functionalities to navigate from the notebook to the dashboard."
- Two participants "(...) commented that the alternative approach of mapping interactions to code hadn't crossed their minds. In other words, the first approach requires that the analyst understands how B2 let them work across the two mediums, and it seems from the results that it's not always apparent."
- It would be interesting to have a _lightweight version_ of B2 in which interactions with a chart would result in a filtered data frame in the next cell.
- In my opinion, B2 is a tool that contributes/may contribute to help to leverage the benefits of visualizing data (in a smoother way). In practice, it is sometimes easier and faster to manipulate a data frame, draw some conclusions, and proceed with the analysis — instead of creating and using a chart. This approximation of charts to data manipulation seems, at least at first glance, to invite the user to plot data, which may enhance the benefits of visualizing data coupled with the possibility of acting immediately based on what we see and select.
